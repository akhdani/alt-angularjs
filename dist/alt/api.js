alt.modules.api=angular.module("alt-api",[]).config(["$provide","$httpProvider",function(e,t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var n=null;e.factory("httpInterceptor",["$log","$q","$window",function(e,t,a){return{request:function(e){if(n=n||e.transformRequest,e.headers["Content-Type"])if(0===e.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")){var t=[],a=function(e,t){if("$$hashKey"==e)return"";var n;switch(typeof t){case"string":case"number":return e+"="+encodeURIComponent(t);case"object":n=[];for(var r in t)t.hasOwnProperty(r)&&"$$hashKey"!=r&&n.push(a(e+"["+r+"]",t[r]));return n.join("&");case"array":n=[];for(var r=0;r<t.length;r++)n.push(a(e+"["+r+"]",t[r]));return n.join("&")}};for(var r in e.data)e.data.hasOwnProperty(r)&&"$$hashKey"!=r&&t.push(a(r,e.data[r]));e.transformRequest=n,e.data=t.join("&")}else 0==e.headers["Content-Type"].indexOf("multipart/form-data")&&(e.transformRequest=[function(t){var n=new FormData,a=function(e,t,n){if("$$hashKey"==t)return"";switch(typeof n){case"string":case"number":e.append(t,n);break;case"object":if("undefined"!=typeof File&&n instanceof File)e.append(t,n);else if("undefined"==typeof File&&"undefined"!=typeof n.name)e.append(t,n);else for(var r in n)n.hasOwnProperty(r)&&"$$hashKey"!=r&&a(e,t+"["+r+"]",n[r]);break;case"array":for(var r=0;r<n.length;r++)a(e,t+"["+r+"]",n[r])}};for(var r in e.data)e.data.hasOwnProperty(r)&&"$$hashKey"!=r&&a(n,r,e.data[r]);return n}],delete e.headers["Content-Type"]);return e},response:function(e){var n=angular.copy(e);if("object"==typeof e.data){if(n.version=e.data.v||100,n.code=e.data.s||e.data.c||e.data.code||e.status||200,n.status=n.code,n.data=e.data.d||e.data.data||e.data,n.message=e.data.m||e.data.msg||e.data,n.time=e.data.t||0,n.usage=e.data.u||"",n.token=e.data.token||e.token||"",200!=n.status)return 401==n.status?(a.location.href=alt.baseUrl+"auth/login",t.reject(n)):(n.message=n.message||"Gagal terhubung ke server",t.reject(n))}else if(0===e.config.url.indexOf(alt.serverUrl)&&200!=e.status&&"object"!=typeof e.data)return n.code=-1,n.status=n.code,n.message="Tidak dapat terhubung ke server","development"==alt.environment.toLowerCase()&&(n.message+="<br/>"+e.data),t.reject(n);return n}}}]),t.interceptors.push("httpInterceptor")}]).factory("$api",["$http","$log","$q",function(e,t,n){return function(t,a,r){t=t||"";var o=t.split("/");return a=a||o[o.length-1]+"id",t=(0!==t.indexOf(alt.serverUrl)?alt.serverUrl:"")+t,r=alt.extend({success:function(){return!0},error:function(){return!0}},r),{url:t,pkey:a,config:r,connect:function(a,o,s){a=a||"",a=(0!==a.indexOf("/")?"/":"")+a,o=o||{},s=alt.extend({skipAuthorization:!1,ismultipart:!1,method:"POST"},s);var i={headers:{"Content-Type":s.ismultipart?"multipart/form-data":"application/x-www-form-urlencoded"},skipAuthorization:s.skipAuthorization,method:s.method,data:o,url:t+a},u=n.defer();return r.connect(i)!==!1?e(i).then(function(e){r.success(e,i)!==!1&&u.resolve(e,i)},function(e){r.error(e,i)!==!1&&u.reject(e,i)}):r.error({message:"Tidak dapat terhubung"},i)!==!1&&u.reject({message:"Tidak dapat terhubung"},i),u.promise},count:function(e,t){return this.connect("count",e,t)},list:function(e,t){return this.connect("list",e,t)},retrieve:function(e,t,n){return e=e||"",t=t||{},t[a]=e,this.connect("retrieve",t,n)},keyvalues:function(e,t){return this.connect("keyvalues",e,t)},insert:function(e,t){return this.connect("insert",e,t)},update:function(e,t){return this.connect("update",e,t)},remove:function(e,t){e=e||"";var n={};return n[a]=e,this.connect("delete",n,t)},isexist:function(e,t){return this.connect("is_exist",e,t)}}}}]),alt.module("alt-api",alt.modules.api);