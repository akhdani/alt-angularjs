alt.modules.api=angular.module("alt-api",[]).config(["$provide","$httpProvider",function(e,t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var r=null;e.factory("httpInterceptor",["$log","$q","$window",function(e,t,n){return{request:function(e){if(r=r||e.transformRequest,e.headers["Content-Type"])if(0===e.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")){var t=[],n=function(e,t){if("$$hashKey"==e)return"";var r;switch(typeof t){case"string":case"number":return e+"="+encodeURIComponent(t);case"object":r=[];for(var a in t)t.hasOwnProperty(a)&&"$$hashKey"!=a&&r.push(n(e+"["+a+"]",t[a]));return r.join("&");case"array":r=[];for(var a=0;a<t.length;a++)r.push(n(e+"["+a+"]",t[a]));return r.join("&")}};for(var a in e.data)e.data.hasOwnProperty(a)&&"$$hashKey"!=a&&t.push(n(a,e.data[a]));e.transformRequest=r,e.data=t.join("&")}else 0==e.headers["Content-Type"].indexOf("multipart/form-data")&&(e.transformRequest=[function(t){var r=new FormData,n=function(e,t,r){if("$$hashKey"==t)return"";switch(typeof r){case"string":case"number":e.append(t,r);break;case"object":if("undefined"!=typeof File&&r instanceof File)e.append(t,r);else if("undefined"==typeof File&&"undefined"!=typeof r.name)e.append(t,r);else for(var a in r)r.hasOwnProperty(a)&&"$$hashKey"!=a&&n(e,t+"["+a+"]",r[a]);break;case"array":for(var a=0;a<r.length;a++)n(e,t+"["+a+"]",r[a])}};for(var a in e.data)e.data.hasOwnProperty(a)&&"$$hashKey"!=a&&n(r,a,e.data[a]);return r}],delete e.headers["Content-Type"]);return e},response:function(e){var r=angular.copy(e);if("object"==typeof e.data){if(r.version=e.data.v||100,r.code=e.data.s||e.data.code||1,r.status=r.code,r.data=e.data.d||e.data.data||"",r.message=e.data.m||e.data.msg||"",r.time=e.data.t||0,r.usage=e.data.u||"",r.token=e.data.token||"",1!=r.status)return"401"==r.status?(n.location.href=alt.baseUrl+"auth/login",t.reject(r)):(r.message=r.message||"Gagal terhubung ke server",t.reject(r))}else if(0===e.config.url.indexOf(alt.serverUrl)&&"object"!=typeof e.data)return r.code=-1,r.status=r.code,r.message="Tidak dapat terhubung ke server","development"==alt.environment.toLowerCase()&&(r.message+="<br/>"+e.data),t.reject(r);return r}}}]),t.interceptors.push("httpInterceptor")}]).factory("$api",["$http","$log","$q",function(e,t,r){return function(t,n,a){t=t||"";var o=t.split("/");return n=n||o[o.length-1]+"id",t=(0!==t.indexOf(alt.serverUrl)?alt.serverUrl:"")+t,a=alt.extend({success:function(){return!0},error:function(){return!0}},a),{url:t,pkey:n,config:a,connect:function(n,o,i){n=n||"",n=(0!==n.indexOf("/")?"/":"")+n,o=o||{},i=alt.extend({skipAuthorization:!1,ismultipart:!1,method:"POST"},i);var s={headers:{"Content-Type":i.ismultipart?"multipart/form-data":"application/x-www-form-urlencoded"},skipAuthorization:i.skipAuthorization,method:i.method,data:o,url:t+n},u=r.defer();return a.connect(s)!==!1?e(s).then(function(e){a.success(e)!==!1&&u.resolve(e)},function(e){a.error(e)!==!1&&u.reject(e)}):a.error(error)!==!1&&u.reject(error),u.promise},count:function(e,t){return this.connect("count",e,t)},list:function(e,t){return this.connect("list",e,t)},retrieve:function(e,t,r){return e=e||"",t=t||{},t[n]=e,this.connect("retrieve",t,r)},keyvalues:function(e,t){return this.connect("keyvalues",e,t)},insert:function(e,t){return this.connect("insert",e,t)},update:function(e,t){return this.connect("update",e,t)},remove:function(e,t){e=e||"";var r={};return r[n]=e,this.connect("delete",r,t)},isexist:function(e,t){return this.connect("is_exist",e,t)}}}}]),alt.module("alt-api",alt.modules.api);