alt.modules.api=angular.module("alt-api",[]).config(["$provide","$httpProvider",function(e,t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var n=null;e.factory("httpInterceptor",["$log","$q","$window",function(e,t,a){return{request:function(e){if(n=n||e.transformRequest,e.headers["Content-Type"])if(0===e.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")){var t=[],a=function(e,t){if("$$hashKey"==e)return"";var n;switch(typeof t){case"string":case"number":return e+"="+encodeURIComponent(t);case"object":n=[];for(var r in t)t.hasOwnProperty(r)&&"$$hashKey"!=r&&n.push(a(e+"["+r+"]",t[r]));return n.join("&");case"array":n=[];for(var r=0;r<t.length;r++)n.push(a(e+"["+r+"]",t[r]));return n.join("&")}};for(var r in e.data)e.data.hasOwnProperty(r)&&"$$hashKey"!=r&&t.push(a(r,e.data[r]));e.transformRequest=n,e.data=t.join("&")}else 0==e.headers["Content-Type"].indexOf("multipart/form-data")&&(e.transformRequest=[function(t){var n=new FormData,a=function(e,t,n){if("$$hashKey"==t)return"";switch(typeof n){case"string":case"number":e.append(t,n);break;case"object":if("undefined"!=typeof File&&n instanceof File)e.append(t,n);else if("undefined"==typeof File&&"undefined"!=typeof n.name)e.append(t,n);else for(var r in n)n.hasOwnProperty(r)&&"$$hashKey"!=r&&a(e,t+"["+r+"]",n[r]);break;case"array":for(var r=0;r<n.length;r++)a(e,t+"["+r+"]",n[r])}};for(var r in e.data)e.data.hasOwnProperty(r)&&"$$hashKey"!=r&&a(n,r,e.data[r]);return n}],delete e.headers["Content-Type"]);return e},response:function(e){var n=angular.copy(e);if("object"==typeof e.data){if(n.version=e.data.v||100,n.code=e.data.s||e.data.code||1,n.status=n.code,n.data=e.data.d||e.data.data||"",n.message=e.data.m||e.data.msg||"",n.time=e.data.t||0,n.usage=e.data.u||"",n.token=e.data.token||"",1!=n.status)return"401"==n.status?(a.location.href=alt.baseUrl+"auth/login",t.reject(n)):(n.message=n.message||"Gagal terhubung ke server",t.reject(n))}else if(0===e.config.url.indexOf(alt.serverUrl)&&"object"!=typeof e.data)return n.code=-1,n.status=n.code,n.message="Tidak dapat terhubung ke server","development"==alt.environment.toLowerCase()&&(n.message+="<br/>"+e.data),t.reject(n);return n}}}]),t.interceptors.push("httpInterceptor")}]).factory("$api",["$http","$log",function(e,t){return function(t,n){t=t||"";var a=t.split("/");return n=n||a[a.length-1]+"id",t=(0!==t.indexOf(alt.serverUrl)?alt.serverUrl:"")+t,{url:t,pkey:n,connect:function(n,a,r){return n=n||"",n=(0!==n.indexOf("/")?"/":"")+n,a=a||{},r=alt.extend({skipAuthorization:!1,ismultipart:!1},r),e({headers:{"Content-Type":r.ismultipart?"multipart/form-data":"application/x-www-form-urlencoded"},skipAuthorization:r.skipAuthorization,method:"POST",data:a,url:t+n})},count:function(e,t){return this.connect("count",e,t)},list:function(e,t){return this.connect("list",e,t)},retrieve:function(e,t,a){return e=e||"",t=t||{},t[n]=e,this.connect("retrieve",t,a)},keyvalues:function(e,t){return this.connect("keyvalues",e,t)},insert:function(e,t){return this.connect("insert",e,t)},update:function(e,t){return this.connect("update",e,t)},remove:function(e,t){e=e||"";var a={};return a[n]=e,this.connect("delete",a,t)},isexist:function(e,t){return this.connect("is_exist",e,t)}}}}]),alt.module("alt-api",alt.modules.api);